name: Generate Naver Cookies

on:
  workflow_dispatch:

jobs:
  generate-cookies:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Install dependencies
      run: |
        npm ci || npm install
    
    - name: Install Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
    
    - name: Generate cookies with Selenium
      env:
        NAVER_ID: ${{ secrets.NAVER_ID }}
        NAVER_PASSWORD: ${{ secrets.NAVER_PASSWORD }}
        HEADLESS: 'false'
      run: |
        echo "ğŸª ì¿ í‚¤ ìƒì„±ì„ ìœ„í•œ ë¡œê·¸ì¸ ì‹œë„..."
        node save-cookies.js || echo "ìˆ˜ë™ ê°œì…ì´ í•„ìš”í•©ë‹ˆë‹¤"
    
    - name: Upload screenshots
      if: always()
      uses: actions/upload-artifact@v3
      with:
        name: login-screenshots
        path: |
          *.png
          naver_cookies.json